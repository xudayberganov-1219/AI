<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mista AI - Kod Yozish Yordamchisi</title>
  <link rel="icon" type="image/png" href="logo.jpg" />
  <style>
      /* Global CSS Variables for Professional Theme */
      :root {
          --background: #ffffff;
          --foreground: #202123;
          --primary: #6d28d9; /* Purple primary color */
          --primary-foreground: #ffffff;
          --secondary: #f7f7f8;
          --secondary-foreground: #202123;
          --muted: #f0f0f0;
          --muted-foreground: #6b7280;
          --border: #e0e0e0;
          --input: #e0e0e0;
          --card-background: #ffffff;
          --card-border: #e0e0e0;
          --code-background: #1e1e1e;
          --code-foreground: #d4d4d4;
      }
      .dark-mode {
          --background: #202123;
          --foreground: #ececf1;
          --primary: #7c3aed;
          --primary-foreground: #ffffff;
          --secondary: #343541;
          --secondary-foreground: #ececf1;
          --muted: #444654;
          --muted-foreground: #a0aec0;
          --border: #565869;
          --input: #565869;
          --card-background: #343541;
          --card-border: #565869;
          --code-background: #1e1e1e;
          --code-foreground: #d4d4d4;
      }
      body {
          margin: 0;
          font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
          background-color: var(--background);
          color: var(--foreground);
          transition: background-color 0.3s ease, color 0.3s ease;
          display: flex;
          flex-direction: column;
          min-height: 100vh;
      }
      header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 1rem;
          border-bottom: 1px solid var(--border);
          background-color: var(--background);
          box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }
      .logo-container {
          display: flex;
          align-items: center;
          gap: 0.5rem;
      }
      .logo-container img {
          height: 32px;
          width: 32px;
          border-radius: 50%;
      }
      .logo-text {
          font-size: 1.25rem;
          font-weight: bold;
          color: var(--primary);
      }
      .theme-toggle-button {
          background: none;
          border: none;
          cursor: pointer;
          font-size: 1.2rem;
          color: var(--foreground);
          padding: 0.5rem;
          border-radius: 0.375rem;
          transition: background-color 0.2s ease, color 0.2s ease;
          display: flex;
          align-items: center;
          justify-content: center;
      }
      .theme-toggle-button:hover {
          background-color: var(--muted);
      }
      main {
          flex: 1;
          display: flex;
          flex-direction: column;
          padding: 1rem;
          max-width: 800px;
          width: 100%;
          margin: 0 auto;
          overflow: hidden;
      }
      .chat-area {
          flex: 1;
          background-color: var(--secondary);
          border-radius: 0.5rem;
          padding: 1rem;
          overflow-y: auto;
          box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
          margin-bottom: 1rem;
          display: flex;
          flex-direction: column;
      }
      .message-bubble-container {
          display: flex;
          align-items: flex-start;
          gap: 0.75rem;
          margin-bottom: 1rem;
          max-width: 100%;
      }
      .message-bubble-container.user {
          justify-content: flex-end;
      }
      .message-bubble-container.assistant {
          justify-content: flex-start;
      }
      .avatar {
          flex-shrink: 0;
          width: 32px;
          height: 32px;
          border-radius: 50%;
          display: flex;
          justify-content: center;
          align-items: center;
          font-size: 0.875rem;
          font-weight: bold;
          color: var(--primary-foreground);
          background-color: var(--primary);
          text-transform: uppercase;
      }
      .message-bubble-container.user .avatar {
          background-color: #a0a0a0;
      }
      .message-content {
          max-width: calc(100% - 32px - 0.75rem);
          padding: 0.75rem 1rem;
          border-radius: 0.75rem;
          box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
          line-height: 1.5;
          font-size: 0.9rem;
          word-wrap: break-word;
      }
      .message-bubble-container.user .message-content {
          background-color: var(--primary);
          color: var(--primary-foreground);
          border-bottom-right-radius: 0.25rem;
      }
      .message-bubble-container.assistant .message-content {
          background-color: var(--card-background);
          color: var(--foreground);
          border-bottom-left-radius: 0.25rem;
          border: 1px solid var(--border);
      }
      /* Code block styling */
      .code-block {
          position: relative;
          margin: 0.5rem 0;
          border-radius: 0.375rem;
          overflow: hidden;
          border: 1px solid var(--border);
      }
      .code-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0.5rem 1rem;
          background-color: var(--code-background);
          color: var(--code-foreground);
          font-family: monospace;
          font-size: 0.8rem;
      }
      .code-actions {
          display: flex;
          gap: 0.5rem;
      }
      .code-action-btn {
          background: none;
          border: none;
          color: var(--code-foreground);
          cursor: pointer;
          font-size: 0.8rem;
          display: flex;
          align-items: center;
          gap: 0.25rem;
          padding: 0.25rem 0.5rem;
          border-radius: 0.25rem;
          transition: background-color 0.2s ease;
      }
      .code-action-btn:hover {
          background-color: rgba(255, 255, 255, 0.1);
      }
      .code-action-btn svg {
          width: 14px;
          height: 14px;
      }
      pre {
          margin: 0;
          padding: 1rem;
          background-color: var(--code-background);
          color: var(--code-foreground);
          font-family: 'Courier New', Courier, monospace;
          font-size: 0.85rem;
          overflow-x: auto;
      }
      /* Explanation styling */
      .explanation {
          background-color: var(--muted);
          padding: 0.75rem 1rem;
          border-radius: 0.375rem;
          margin: 0.5rem 0;
          font-size: 0.9rem;
          line-height: 1.5;
      }
      /* Run result styling */
      .run-result {
          margin-top: 0.5rem;
          padding: 0.75rem 1rem;
          background-color: var(--muted);
          border-radius: 0.375rem;
          border-left: 3px solid var(--primary);
      }
      .run-result-title {
          font-weight: bold;
          margin-bottom: 0.5rem;
          color: var(--primary);
      }
      /* Loading Dots Animation */
      .loading-dots {
          display: flex;
          align-items: center;
          gap: 4px;
          padding: 0.5rem 0;
      }
      .loading-dots span {
          width: 8px;
          height: 8px;
          background-color: var(--muted-foreground);
          border-radius: 50%;
          animation: bounce 1.4s infinite ease-in-out both;
      }
      .loading-dots span:nth-child(1) {
          animation-delay: -0.32s;
      }
      .loading-dots span:nth-child(2) {
          animation-delay: -0.16s;
      }
      @keyframes bounce {
          0%, 80%, 100% {
              transform: scale(0);
          }
          40% {
              transform: scale(1);
          }
      }
      .input-area {
          display: flex;
          align-items: flex-end;
          gap: 0.75rem;
          padding: 1rem;
          border-top: 1px solid var(--border);
          background-color: var(--background);
          border-radius: 0.5rem;
          box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
          margin-top: 1rem;
      }
      .input-area textarea {
          flex: 1;
          min-height: 48px;
          max-height: 150px;
          resize: none;
          padding: 0.75rem 1rem;
          border: 1px solid var(--input);
          border-radius: 0.5rem;
          background-color: var(--background);
          color: var(--foreground);
          font-size: 1rem;
          transition: border-color 0.2s ease, box-shadow 0.2s ease;
      }
      .input-area textarea:focus {
          outline: none;
          border-color: var(--primary);
          box-shadow: 0 0 0 2px rgba(109, 40, 217, 0.2);
      }
      .send-button {
          background-color: var(--primary);
          color: var(--primary-foreground);
          border: none;
          border-radius: 0.5rem;
          padding: 0.75rem;
          cursor: pointer;
          display: flex;
          justify-content: center;
          align-items: center;
          transition: background-color 0.2s ease, opacity 0.2s ease;
          height: 48px;
          width: 48px;
      }
      .send-button:hover:not(:disabled) {
          background-color: #5b21b6;
      }
      .send-button:disabled {
          opacity: 0.5;
          cursor: not-allowed;
      }
      .send-button svg {
          width: 20px;
          height: 20px;
      }
      footer {
          display: flex;
          justify-content: center;
          align-items: center;
          padding: 1rem;
          border-top: 1px solid var(--border);
          background-color: var(--background);
          font-size: 0.8rem;
          color: var(--muted-foreground);
          box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.03);
      }
      footer a {
          color: var(--primary);
          text-decoration: none;
          transition: text-decoration 0.2s ease;
          margin-left: 0.25rem;
      }
      footer a:hover {
          text-decoration: underline;
      }
      /* Responsive adjustments */
      @media (max-width: 600px) {
          header, .input-area, footer {
              padding: 0.75rem;
          }
          .logo-text {
              font-size: 1.1rem;
          }
          .logo-container img {
              height: 28px;
              width: 28px;
          }
          .theme-toggle-button {
              font-size: 1rem;
              padding: 0.4rem;
          }
          .chat-area {
              padding: 0.75rem;
          }
          .message-content {
              font-size: 0.85rem;
              padding: 0.6rem 0.8rem;
          }
          .input-area textarea {
              font-size: 0.9rem;
              min-height: 40px;
              padding: 0.6rem 0.8rem;
          }
          .send-button {
              height: 40px;
              width: 40px;
              padding: 0.6rem;
          }
      }
  </style>
</head>
<body class="light-mode">
  <header>
      <div class="logo-container">
          <img src="./logo.jpg" alt="Mista AI Logo" />
          <h1 class="logo-text">Mista AI</h1>
      </div>
      <button class="theme-toggle-button" aria-label="Mavzuni almashtirish" onclick="toggleTheme()">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="M4.93 19.07l1.41-1.41"/><path d="M17.66 6.34l1.41-1.41"/></svg>
      </button>
  </header>
  <main>
      <div class="chat-area" id="chat-area">
          <!-- Messages will be dynamically added here by JavaScript -->
      </div>
      <div class="input-area">
          <textarea id="question" rows="1" placeholder="Savolingizni yoki kod so'rovingizni kiriting..." oninput="autoResize(this)"></textarea>
          <button onclick="send()" id="sendBtn" class="send-button" disabled>
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send"><path d="m22 2-7 20-4-9-9-4 20-7Z"/><path d="M22 2 11 13"/></svg>
          </button>
      </div>
  </main>
  <footer>
      <p>Qo'shimcha ✨ | <a href="https://t.me/mistaai_bot" target="_blank" rel="noopener noreferrer">Telegram Bot</a></p>
      <p style="margin-left: 1rem;">Ilyos Xudaybergaov tomonidan yaratilgan.</p>
  </footer>
  <script>
      const chat = document.getElementById("chat-area");
      const textarea = document.getElementById("question");
      const sendBtn = document.getElementById("sendBtn");
      const themeToggleButton = document.querySelector('.theme-toggle-button');

      const initialMessage = {
          role: "assistant",
          content: "Assalomu alaykum! Men Mista AI yordamchingizman. Kod yozishda yoki dasturlashga oid savollaringizga javob bera olaman. Kod so'rovlaringizda men kodni alohida blokda ko'rsatib, tushuntirish matnini beraman va kodni nusxalash va ishga tushirish imkoniyatini taqdim etaman. Sizga qanday yordam bera olaman?"
      };

      function addMessageToChat(message) {
          const messageContainer = document.createElement("div");
          messageContainer.className = `message-bubble-container ${message.role}`;

          const avatar = document.createElement("div");
          avatar.className = "avatar";
          avatar.innerText = message.role === "user" ? "Siz" : "AI";

          const messageContentDiv = document.createElement("div");
          messageContentDiv.className = "message-content";

          if (message.type === "code") {
              // Add explanation if exists
              if (message.explanation) {
                  const explanationDiv = document.createElement("div");
                  explanationDiv.className = "explanation";
                  explanationDiv.innerHTML = message.explanation;
                  messageContentDiv.appendChild(explanationDiv);
              }

              // Add code block
              const codeBlockDiv = document.createElement("div");
              codeBlockDiv.className = "code-block";

              const codeHeader = document.createElement("div");
              codeHeader.className = "code-header";
              codeHeader.innerHTML = `<span>${message.language || 'code'}</span>`;

              const codeActions = document.createElement("div");
              codeActions.className = "code-actions";

              const copyBtn = document.createElement("button");
              copyBtn.className = "code-action-btn";
              copyBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg> Nusxalash`;
              copyBtn.onclick = () => {
                  navigator.clipboard.writeText(message.code);
                  copyBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check"><path d="M20 6 9 17l-5-5"/></svg> Nusxalandi!`;
                  setTimeout(() => {
                      copyBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg> Nusxalash`;
                  }, 2000);
              };

              const runBtn = document.createElement("button");
              runBtn.className = "code-action-btn";
              runBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-play"><polygon points="5 3 19 12 5 21 5 3"/></svg> Ishga tushirish`;
              runBtn.onclick = () => {
                  runCode(message.code, message.language, messageContainer);
              };

              codeActions.appendChild(copyBtn);
              codeActions.appendChild(runBtn);
              codeHeader.appendChild(codeActions);
              codeBlockDiv.appendChild(codeHeader);

              const pre = document.createElement("pre");
              pre.textContent = message.code;
              codeBlockDiv.appendChild(pre);

              messageContentDiv.appendChild(codeBlockDiv);

              // Add run result if exists
              if (message.runResult) {
                  const runResultDiv = document.createElement("div");
                  runResultDiv.className = "run-result";
                  runResultDiv.innerHTML = `
                      <div class="run-result-title">Natija:</div>
                      <div>${message.runResult}</div>
                  `;
                  messageContentDiv.appendChild(runResultDiv);
              }
          } else {
              // Regular text message
              messageContentDiv.innerHTML = message.content;
          }

          if (message.role === "user") {
              messageContainer.appendChild(messageContentDiv);
              messageContainer.appendChild(avatar);
          } else {
              messageContainer.appendChild(avatar);
              messageContainer.appendChild(messageContentDiv);
          }

          chat.appendChild(messageContainer);
          chat.scrollTop = chat.scrollHeight;
          return messageContainer;
      }

      function runCode(code, language, messageContainer) {
          // In a real app, you would send this to a backend service to execute
          // For demo purposes, we'll simulate execution for JavaScript
          
          const runResultDiv = messageContainer.querySelector('.run-result');
          if (runResultDiv) {
              runResultDiv.remove();
          }

          const newRunResultDiv = document.createElement("div");
          newRunResultDiv.className = "run-result";
          
          const runResultTitle = document.createElement("div");
          runResultTitle.className = "run-result-title";
          runResultTitle.textContent = "Natija:";
          
          const runResultContent = document.createElement("div");
          runResultContent.textContent = "Ishga tushirilmoqda...";
          
          newRunResultDiv.appendChild(runResultTitle);
          newRunResultDiv.appendChild(runResultContent);
          
          messageContainer.querySelector('.message-content').appendChild(newRunResultDiv);
          
          // Simulate execution delay
          setTimeout(() => {
              if (language === 'javascript' || language === 'js') {
                  try {
                      // In a real app, NEVER use eval() - this is just for demo
                      const originalConsoleLog = console.log;
                      let output = '';
                      
                      console.log = function() {
                          output += Array.from(arguments).join(' ') + '\n';
                          originalConsoleLog.apply(console, arguments);
                      };
                      
                      eval(code);
                      console.log = originalConsoleLog;
                      
                      runResultContent.textContent = output || "Kod muvaffaqiyatli ishga tushdi (hech qanday chiqish yo'q).";
                  } catch (err) {
                      runResultContent.textContent = `Xato: ${err.message}`;
                  }
              } else {
                  runResultContent.textContent = "Ushbu til uchun demo rejimida ishga tushirish imkoniyati mavjud emas. Haqiqiy ilovada bu backend xizmati orqali amalga oshiriladi.";
              }
          }, 1000);
      }

      document.addEventListener('DOMContentLoaded', () => {
          addMessageToChat(initialMessage);
          autoResize(textarea);
      });

      textarea.addEventListener("input", () => {
          autoResize(textarea);
          sendBtn.disabled = textarea.value.trim().length === 0;
      });

      function autoResize(textarea) {
          textarea.style.height = 'auto';
          textarea.style.height = textarea.scrollHeight + 'px';
      }

      function toggleTheme() {
          document.body.classList.toggle("dark-mode");
          const isDarkMode = document.body.classList.contains("dark-mode");
          themeToggleButton.innerHTML = isDarkMode
              ? '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>'
              : '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="M4.93 19.07l1.41-1.41"/><path d="M17.66 6.34l1.41-1.41"/></svg>';
      }

      async function send() {
          const q = textarea.value.trim();
          if (!q) return;

          addMessageToChat({ role: "user", content: q, type: "text" });
          textarea.value = "";
          sendBtn.disabled = true;

          // Create loading message
          const loadingMessageContainer = document.createElement("div");
          loadingMessageContainer.className = `message-bubble-container assistant loading-indicator`;

          const avatar = document.createElement("div");
          avatar.className = "avatar";
          avatar.innerText = "AI";

          const messageContentDiv = document.createElement("div");
          messageContentDiv.className = "message-content";

          const loadingDotsContainer = document.createElement("div");
          loadingDotsContainer.className = "loading-dots";
          for (let i = 0; i < 3; i++) {
              const dot = document.createElement("span");
              loadingDotsContainer.appendChild(dot);
          }
          messageContentDiv.appendChild(loadingDotsContainer);

          loadingMessageContainer.appendChild(avatar);
          loadingMessageContainer.appendChild(messageContentDiv);
          chat.appendChild(loadingMessageContainer);
          chat.scrollTop = chat.scrollHeight;

          try {
              // In a real app, you would call your backend API here
              // For demo, we'll simulate a response
              setTimeout(() => {
                  // Remove loading message
                  loadingMessageContainer.remove();

                  // Check if the question is about code
                  if (q.toLowerCase().includes("kod") || q.toLowerCase().includes("code") || 
                      q.toLowerCase().includes("dastur") || q.toLowerCase().includes("program")) {
                      // Simulate code response
                      const codeExample = `// Salom dunyo dasturi
function salomDunyo() {
    console.log("Salom, Dunyo!");
    return "Mista AI dan salom!";
}

salomDunyo();`;

                      addMessageToChat({
                          role: "assistant",
                          content: "Sizning kod so'rovingizga javob. Quyida kod va tushuntirish berilgan:",
                          type: "code",
                          code: codeExample,
                          language: "javascript",
                          explanation: "Bu JavaScript dasturi 'Salom, Dunyo!' xabarini konsolga chiqaradi va qaytaradi. Funktsiya yaratilgan va chaqirilgan."
                      });
                  } else {
                      // Regular text response
                      addMessageToChat({
                          role: "assistant",
                          content: "Bu oddiy savolingizga javob. Agar kod so'rov bo'lsa, men kodni alohida ko'rsatib, tushuntirish beraman.",
                          type: "text"
                      });
                  }
              }, 1500);
          } catch (err) {
              loadingMessageContainer.remove();
              addMessageToChat({ 
                  role: "assistant", 
                  content: "❌ Xatolik yuz berdi: " + err.message, 
                  type: "text" 
              });
          }
      }
  </script>
</body>
</html>
