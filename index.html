<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MathGenius AI Yordamchi</title>
    <link rel="icon" type="image/png" href="logo.jpg" />
    <style>
        /* Global CSS Variables for Professional Theme (ChatGPT-like) */
        :root {
            --background: #ffffff; /* White */
            --foreground: #202123; /* Dark Gray */
            --primary: #10a37f; /* ChatGPT Green */
            --primary-foreground: #ffffff; /* White text on primary */
            --secondary: #f7f7f8; /* Light Gray for secondary elements */
            --secondary-foreground: #202123; /* Dark text on secondary */
            --muted: #f0f0f0; /* Very Light Gray for muted backgrounds */
            --muted-foreground: #6b7280; /* Medium Gray for muted text */
            --border: #e0e0e0; /* Light border */
            --input: #e0e0e0; /* Light input border */
            --card-background: #ffffff; /* White card background */
            --card-border: #e0e0e0; /* Light card border */

            /* MathGenius Logo Colors */
            --mg-green: #00E676;
            --mg-blue: #00B0FF;
        }

        .dark-mode {
            --background: #202123; /* Dark background */
            --foreground: #ececf1; /* Light Gray */
            --primary: #10a37f; /* ChatGPT Green (same for dark mode) */
            --primary-foreground: #ffffff; /* White text on primary */
            --secondary: #343541; /* Darker Gray for secondary elements */
            --secondary-foreground: #ececf1; /* Light text on secondary */
            --muted: #444654; /* Dark Gray for muted backgrounds */
            --muted-foreground: #a0aec0; /* Light Gray for muted text */
            --border: #565869; /* Dark border */
            --input: #565869; /* Dark input border */
            --card-background: #343541; /* Dark card background */
            --card-border: #565869; /* Dark card border */
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            background-color: var(--background);
            color: var(--foreground);
            transition: background-color 0.3s ease, color 0.3s ease;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border);
            background-color: var(--background);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-container img {
            height: 32px; /* Slightly smaller for header */
            width: 32px;
        }

        .logo-text {
            font-size: 1.25rem; /* Adjusted font size */
            font-weight: bold;
        }

        .logo-text .math {
            color: var(--mg-green);
        }

        .logo-text .genius {
            color: var(--mg-blue);
        }

        .theme-toggle-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem; /* Adjusted icon size */
            color: var(--foreground);
            padding: 0.5rem;
            border-radius: 0.375rem;
            transition: background-color 0.2s ease, color 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle-button:hover {
            background-color: var(--muted);
        }

        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 1rem;
            max-width: 800px;
            width: 100%;
            margin: 0 auto;
            overflow: hidden;
        }

        .chat-area {
            flex: 1;
            background-color: var(--secondary); /* Lighter background for chat area */
            border-radius: 0.5rem;
            padding: 1rem;
            overflow-y: auto;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
        }

        .message-bubble-container {
            display: flex;
            align-items: flex-start; /* Align to top for multi-line messages */
            gap: 0.75rem;
            margin-bottom: 1rem;
            max-width: 100%;
        }

        .message-bubble-container.user {
            justify-content: flex-end;
        }

        .message-bubble-container.assistant {
            justify-content: flex-start;
        }

        .avatar {
            flex-shrink: 0; /* Prevent avatar from shrinking */
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.875rem;
            font-weight: bold;
            color: var(--primary-foreground);
            background-color: var(--primary);
            text-transform: uppercase;
        }

        .message-bubble-container.user .avatar {
            background-color: #a0a0a0; /* Neutral gray for user avatar */
        }

        .message-content {
            max-width: calc(100% - 32px - 0.75rem); /* Account for avatar and gap */
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            line-height: 1.5;
            font-size: 0.9rem;
            word-wrap: break-word; /* Ensure long words break */
        }

        .message-bubble-container.user .message-content {
            background-color: var(--primary);
            color: var(--primary-foreground);
            border-bottom-right-radius: 0.25rem; /* Small tail effect */
        }

        .message-bubble-container.assistant .message-content {
            background-color: var(--card-background);
            color: var(--foreground);
            border-bottom-left-radius: 0.25rem; /* Small tail effect */
            border: 1px solid var(--border); /* Add border for assistant messages */
        }

        .message-content .latex-image-container {
            background-color: var(--card-background);
            padding: 0.5rem;
            border-radius: 0.375rem;
            border: 1px solid var(--card-border);
            margin-top: 0.5rem;
            display: inline-block; /* To wrap content */
        }

        .message-content .latex-image-container img {
            max-width: 100%;
            height: auto;
            display: block;
        }

        .message-content .latex-image-container p {
            font-size: 0.7rem;
            color: var(--muted-foreground);
            margin-top: 0.25rem;
            text-align: center;
        }

        .input-area {
            display: flex;
            align-items: flex-end;
            gap: 0.75rem;
            padding: 1rem;
            border-top: 1px solid var(--border);
            background-color: var(--background);
            border-radius: 0.5rem;
            box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.05);
            margin-top: 1rem;
        }

        .input-area textarea {
            flex: 1;
            min-height: 48px; /* Increased min-height */
            max-height: 150px; /* Max height for textarea */
            resize: none;
            padding: 0.75rem 1rem;
            border: 1px solid var(--input);
            border-radius: 0.5rem;
            background-color: var(--background);
            color: var(--foreground);
            font-size: 1rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .input-area textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(16, 163, 127, 0.2); /* Use primary color for focus ring */
        }

        .send-button {
            background-color: var(--primary);
            color: var(--primary-foreground);
            border: none;
            border-radius: 0.5rem;
            padding: 0.75rem;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.2s ease, opacity 0.2s ease;
            height: 48px; /* Match textarea height */
            width: 48px;
        }

        .send-button:hover:not(:disabled) {
            background-color: #0e8a6a; /* Darker green for hover */
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .send-button svg {
            width: 20px;
            height: 20px;
        }

        footer {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            border-top: 1px solid var(--border);
            background-color: var(--background);
            font-size: 0.8rem;
            color: var(--muted-foreground);
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.03);
        }

        footer a {
            color: var(--primary);
            text-decoration: none;
            transition: text-decoration 0.2s ease;
            margin-left: 0.25rem;
        }

        footer a:hover {
            text-decoration: underline;
        }

        /* Responsive adjustments */
        @media (max-width: 600px) {
            header, .input-area, footer {
                padding: 0.75rem;
            }
            .logo-text {
                font-size: 1.1rem;
            }
            .logo-container img {
                height: 28px;
                width: 28px;
            }
            .theme-toggle-button {
                font-size: 1rem;
                padding: 0.4rem;
            }
            .chat-area {
                padding: 0.75rem;
            }
            .message-content {
                font-size: 0.85rem;
                padding: 0.6rem 0.8rem;
            }
            .input-area textarea {
                font-size: 0.9rem;
                min-height: 40px;
                padding: 0.6rem 0.8rem;
            }
            .send-button {
                height: 40px;
                width: 40px;
                padding: 0.6rem;
            }
        }
    </style>
</head>
<body class="light-mode">
    <header>
        <div class="logo-container">
            <img src="./logo.jpg" alt="MathGenius Logo" />
            <h1 class="logo-text">
                <span class="math">Math</span><span class="genius">Genius</span>
            </h1>
        </div>
        <button class="theme-toggle-button" aria-label="Mavzuni almashtirish" onclick="toggleTheme()">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-sun"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="M4.93 19.07l1.41-1.41"/><path d="M17.66 6.34l1.41-1.41"/></svg>
        </button>
    </header>

    <main>
        <div class="chat-area" id="chat-area">
            <!-- Messages will be dynamically added here by JavaScript -->
        </div>

        <div class="input-area">
            <textarea id="question" rows="1" placeholder="Savolingizni kiriting..." oninput="autoResize(this)"></textarea>
            <button onclick="send()" id="sendBtn" class="send-button" disabled>
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-send"><path d="m22 2-7 20-4-9-9-4 20-7Z"/><path d="M22 2 11 13"/></svg>
            </button>
        </div>
    </main>

    <footer>
        <p>Qo'shimcha ✨ | <a href="https://t.me/mathgeniusai_bot" target="_blank" rel="noopener noreferrer">Telegram Bot</a></p>
        <p style="margin-left: 1rem;">Ilyos Xudaybergaov tomonidan yaratilgan.</p>
    </footer>

   <script>
    const chat = document.getElementById("chat-area");
    const textarea = document.getElementById("question");
    const sendBtn = document.getElementById("sendBtn");
    const themeToggleButton = document.querySelector('.theme-toggle-button');

    const initialMessage = {
        role: "assistant",
        content: "Assalomu alaykum! Men MathGenius AI yordamchingizman. Istalgan savolni yozing — men rasm va matn shaklida javob beraman. Sizga qanday yordam bera olaman?"
    };

    function addMessageToChat(message) {
        const messageContainer = document.createElement("div");
        messageContainer.className = `message-bubble-container ${message.role}`;

        const avatar = document.createElement("div");
        avatar.className = "avatar";
        avatar.innerText = message.role === "user" ? "Siz" : "AI";

        const messageContentDiv = document.createElement("div");
        messageContentDiv.className = "message-content";

        if (message.type === "latex") {
            const textPart = document.createElement("p");
            textPart.innerText = message.content;
            messageContentDiv.appendChild(textPart);

            const latexImageContainer = document.createElement("div");
            latexImageContainer.className = "latex-image-container";
            const latexImage = document.createElement("img");
            latexImage.src = message.latexImageUrl || "/placeholder.svg?height=100&width=300";
            latexImage.alt = "Matematik formula";
            const latexCaption = document.createElement("p");
            latexCaption.innerText = "(Yuqoridagi formula LaTeX formatida berilgan javobdir)";
            latexImageContainer.appendChild(latexImage);
            latexImageContainer.appendChild(latexCaption);
            messageContentDiv.appendChild(latexImageContainer);
        } else {
            const textPart = document.createElement("p");
            textPart.innerText = message.content;
            messageContentDiv.appendChild(textPart);
        }

        if (message.role === "user") {
            messageContainer.appendChild(messageContentDiv);
            messageContainer.appendChild(avatar);
        } else {
            messageContainer.appendChild(avatar);
            messageContainer.appendChild(messageContentDiv);
        }

        chat.appendChild(messageContainer);
        chat.scrollTop = chat.scrollHeight;
    }

    document.addEventListener('DOMContentLoaded', () => {
        addMessageToChat(initialMessage);
        autoResize(textarea);
    });

    textarea.addEventListener("input", () => {
        autoResize(textarea);
        sendBtn.disabled = textarea.value.trim().length === 0;
    });

    function autoResize(textarea) {
        textarea.style.height = 'auto';
        textarea.style.height = textarea.scrollHeight + 'px';
    }

    function toggleTheme() {
        document.body.classList.toggle("dark-mode");
        const isDarkMode = document.body.classList.contains("dark-mode");
        themeToggleButton.innerHTML = isDarkMode
            ? '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>'
            : '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="M4.93 4.93l1.41 1.41"/><path d="M17.66 17.66l1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="M4.93 19.07l1.41-1.41"/><path d="M17.66 6.34l1.41-1.41"/></svg>';
    }

    async function send() {
        const q = textarea.value.trim();
        if (!q) return;

        addMessageToChat({ role: "user", content: q, type: "text" });
        textarea.value = "";
        sendBtn.disabled = true;

        const loadingMessage = { role: "assistant", content: "⏳ Javob tayyorlanmoqda...", type: "text" };
        addMessageToChat(loadingMessage);

        try {
            const res = await fetch("http://localhost:5000/ask", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ question: q })
            });

            const data = await res.json();

            if (data.error) {
                addMessageToChat({ role: "assistant", content: "❌ Xatolik: " + data.error, type: "text" });
            } else if (data.latex_image_url) {
                addMessageToChat({
                    role: "assistant",
                    content: data.answer,
                    type: "latex",
                    latexImageUrl: data.latex_image_url
                });
            } else {
                addMessageToChat({
                    role: "assistant",
                    content: data.answer || "❗ Javob topilmadi.",
                    type: "text"
                });
            }

        } catch (err) {
            addMessageToChat({ role: "assistant", content: "❌ Tarmoqda xatolik: " + err.message, type: "text" });
        }
    }
</script>

</body>
</html>
